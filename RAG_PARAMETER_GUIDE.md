# RAG_PARAMETER_GUIDE.md

## π“‹ κ°μ”

μ΄ λ¬Έμ„λ” MOJI AI Agentμ RAG(Retrieval-Augmented Generation) μ‹μ¤ν…μ—μ„ μ‚¬μ©ν•  μ μλ” λ¨λ“  μ¤‘μ”ν• νλΌλ―Έν„°λ“¤μ μ„μΉμ™€ κΈ°λ¥μ„ μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤. κ° νλΌλ―Έν„°λ¥Ό μ΅°μ •ν•μ—¬ μ„±λ¥κ³Ό ν’μ§μ μµμ  κ· ν•μ μ„ μ°Ύμ„ μ μμµλ‹λ‹¤.

## π― νλΌλ―Έν„° μΉ΄ν…κ³ λ¦¬

### 1. μ²­ν‚Ή(Chunking) νλΌλ―Έν„°
### 2. κ²€μƒ‰(Search) νλΌλ―Έν„°  
### 3. ν•μ΄λΈλ¦¬λ“ κ²€μƒ‰ κ°€μ¤‘μΉ
### 4. μ„±λ¥ μµμ ν™” νλΌλ―Έν„°
### 5. ν’μ§ ν–¥μƒ νλΌλ―Έν„°

---

## π“ **1. μ²­ν‚Ή(Chunking) νλΌλ―Έν„°**

### π”§ **κΈ°λ³Έ μ²­ν‚Ή μ„¤μ •**

**νμΌ μ„μΉ**: `app/rag/enhanced_rag.py` (43-47ν–‰)

```python
def __init__(
    self,
    chunk_size: int = 1500,              # μ²­ν¬ ν¬κΈ° (λ¬Έμ μ)
    chunk_overlap: int = 500,            # μ²­ν¬ μ¤‘λ³µ (λ¬Έμ μ)
    use_semantic_chunking: bool = True,  # μλ―Έλ΅ μ  μ²­ν‚Ή μ‚¬μ©
):
```

#### **νλΌλ―Έν„° μ„¤λ…**

| νλΌλ―Έν„° | κΈ°λ³Έκ°’ | λ²”μ„ | μ„¤λ… |
|---------|--------|------|------|
| `chunk_size` | 1500 | 300-3000 | κ° ν…μ¤νΈ μ²­ν¬μ μµλ€ λ¬Έμ μ |
| `chunk_overlap` | 500 | 50-1000 | μΈμ ‘ μ²­ν¬ κ°„ μ¤‘λ³µλλ” λ¬Έμ μ |
| `use_semantic_chunking` | True | True/False | μλ―Έλ΅ μ  μ²­ν‚Ή ν™μ„±ν™” μ—¬λ¶€ |

#### **μ΅°μ • κ°€μ΄λ“**

**`chunk_size` (μ²­ν¬ ν¬κΈ°)**
- **μ‘κ² μ„¤μ • (500-1000μ)**:
  - β… μ •ν™•ν• κ²€μƒ‰ κ²°κ³Ό
  - β… λΉ λ¥Έ μ²λ¦¬ μ†λ„
  - β μ»¨ν…μ¤νΈ λ¶€μ΅± μ„ν—
  
- **ν¬κ² μ„¤μ • (1500-2500μ)**:
  - β… ν’λ¶€ν• μ»¨ν…μ¤νΈ
  - β… μ™„μ „ν• μ •λ³΄ ν¬ν•¨
  - β κ²€μƒ‰ λ…Έμ΄μ¦ μ¦κ°€
  - β λλ¦° μ²λ¦¬ μ†λ„

**`chunk_overlap` (μ²­ν¬ μ¤‘λ³µ)**
- **κ¶μ¥κ°’**: chunk_sizeμ 20-50%
- **λ‚®μ€ κ°’ (100-200μ)**: μ¤‘λ³µ μµμ†ν™”, κ²½κ³„ μ •λ³΄ μ†μ‹¤ μ„ν—
- **λ†’μ€ κ°’ (400-800μ)**: κ²½κ³„ μ •λ³΄ λ³΄μ΅΄, μ €μ¥ κ³µκ°„ μ¦κ°€

---

### π§© **μλ―Έλ΅ μ  μ²­ν‚Ή μ„Έλ¶€ μ„¤μ •**

**νμΌ μ„μΉ**: `app/rag/semantic_chunker.py` (48-54ν–‰)

```python
def __init__(
    self,
    similarity_threshold: float = 0.5,    # μ μ‚¬λ„ μ„κ³„κ°’
    use_structure_hints: bool = True,     # κµ¬μ΅° ννΈ μ‚¬μ©
):
```

#### **μ΅°μ • κ°€μ΄λ“**

**`similarity_threshold` (μ μ‚¬λ„ μ„κ³„κ°’)**
- **λ‚®μ€ κ°’ (0.3-0.5)**: λ” λ§μ€ λ¬Έμ¥μ„ ν•λ‚μ μ²­ν¬λ΅ κ·Έλ£Ήν™”
- **λ†’μ€ κ°’ (0.6-0.8)**: λ” μ—„κ²©ν• μλ―Έ λ‹¨μ„λ΅ λ¶„ν• 
- **κ¶μ¥κ°’**: 0.4-0.7

---

## π“ **2. κ²€μƒ‰(Search) νλΌλ―Έν„°**

### π” **κΈ°λ³Έ κ²€μƒ‰ μ„¤μ •**

**νμΌ μ„μΉ**: `app/rag/enhanced_rag.py`

```python
# μΏΌλ¦¬ μ¬μ‘μ„±κ³Ό ν•¨κ» κ²€μƒ‰ (522ν–‰)
async def search_with_rewriting(
    self,
    query: str,
    k: int = 5,                      # κ²€μƒ‰ν•  λ¬Έμ„ μ
    score_threshold: float = 2.0,    # μ μ μ„κ³„κ°’
):

# μ‹ λΆ°λ„μ™€ ν•¨κ» λ‹µλ³€ μƒμ„± (795ν–‰)
async def answer_with_confidence(
    self,
    query: str,
    k: int = 5,                      # κ²€μƒ‰ν•  λ¬Έμ„ μ
    score_threshold: float = 1.5,    # μ μ μ„κ³„κ°’
):
```

#### **νλΌλ―Έν„° μ„¤λ…**

| νλΌλ―Έν„° | κΈ°λ³Έκ°’ | λ²”μ„ | μ„¤λ… |
|---------|--------|------|------|
| `k` | 5 | 1-20 | κ²€μƒ‰μ—μ„ κ°€μ Έμ¬ λ¬Έμ„ κ°μ |
| `score_threshold` | 1.5-2.0 | 0.1-5.0 | μ μ‚¬λ„ μ μ μ„κ³„κ°’ |

#### **μ΅°μ • κ°€μ΄λ“**

**`k` (κ²€μƒ‰ λ¬Έμ„ μ)**
- **μ‘μ€ κ°’ (1-3κ°)**: λΉ λ¥Έ μ²λ¦¬, λ†’μ€ μ •ν™•λ„, μ •λ³΄ λ¶€μ΅± μ„ν—
- **ν° κ°’ (7-15κ°)**: ν’λ¶€ν• μ •λ³΄, λ…Έμ΄μ¦ μ¦κ°€, λλ¦° μ²λ¦¬

**`score_threshold` (μ μ μ„κ³„κ°’)**
- **λ‚®μ€ κ°’ (0.5-1.5)**: λ” λ§μ€ ν›„λ³΄ λ¬Έμ„ ν¬ν•¨ (μ¬ν„μ¨ β†‘)
- **λ†’μ€ κ°’ (2.0-4.0)**: κ³ ν’μ§ λ¬Έμ„λ§ μ„ νƒ (μ •λ°€λ„ β†‘)
- **μ–Έμ–΄λ³„ κ¶μ¥κ°’**: ν•κµ­μ–΄ 1.0-3.0, μμ–΄ 0.5-2.0

---

## π“ **3. ν•μ΄λΈλ¦¬λ“ κ²€μƒ‰ κ°€μ¤‘μΉ**

### β–οΈ **κ²€μƒ‰ λ°©μ‹λ³„ κ°€μ¤‘μΉ**

**νμΌ μ„μΉ**: `app/rag/hybrid_search.py` (83-87ν–‰)

```python
def __init__(
    self,
    vector_weight: float = 0.4,    # λ²΅ν„° κ²€μƒ‰ κ°€μ¤‘μΉ
    keyword_weight: float = 0.4,   # ν‚¤μ›λ“ κ²€μƒ‰ κ°€μ¤‘μΉ
    bm25_weight: float = 0.2,      # BM25 κ°€μ¤‘μΉ
):
```

#### **κ°€μ¤‘μΉ μ„¤λ…**

| κ²€μƒ‰ λ°©μ‹ | κΈ°λ³Έκ°’ | λ²”μ„ | νΉμ§• |
|----------|--------|------|------|
| `vector_weight` | 0.4 | 0.1-0.8 | μλ―Έμ  μ μ‚¬μ„± μ¤‘μ‹¬ |
| `keyword_weight` | 0.4 | 0.1-0.7 | μ •ν™•ν• λ‹¨μ–΄ μΌμΉ μ¤‘μ‹¬ |
| `bm25_weight` | 0.2 | 0.1-0.5 | μ „ν†µμ  μ •λ³΄κ²€μƒ‰ λ°©μ‹ |

> **β οΈ μ¤‘μ”**: λ¨λ“  κ°€μ¤‘μΉμ ν•©μ€ 1.0μ΄ λμ–΄μ•Ό ν•©λ‹λ‹¤.

#### **μ‹λ‚λ¦¬μ¤λ³„ κ¶μ¥ μ„¤μ •**

**μλ―Έ κ²€μƒ‰ μ¤‘μ‹¬** (λ³µμ΅ν• μ§λ¬Έ, κ°λ…μ  μ§μ):
```python
vector_weight = 0.6
keyword_weight = 0.25
bm25_weight = 0.15
```

**ν‚¤μ›λ“ κ²€μƒ‰ μ¤‘μ‹¬** (μ •ν™•ν• μ©μ–΄, κΈ°μ  λ¬Έμ„):
```python
vector_weight = 0.3
keyword_weight = 0.5
bm25_weight = 0.2
```

**κ· ν• κ²€μƒ‰** (μΌλ°μ  μ‚¬μ©):
```python
vector_weight = 0.4
keyword_weight = 0.4
bm25_weight = 0.2
```

---

## π“ **4. BM25 μ•κ³ λ¦¬μ¦ νλΌλ―Έν„°**

**νμΌ μ„μΉ**: `app/rag/hybrid_search.py` (26-27ν–‰)

```python
def __init__(self, corpus: List[str], k1: float = 1.2, b: float = 0.75):
    self.k1 = k1  # μ©μ–΄ λΉλ„ ν¬ν™”μ 
    self.b = b    # λ¬Έμ„ κΈΈμ΄ μ •κ·ν™” κ°•λ„
```

| νλΌλ―Έν„° | κΈ°λ³Έκ°’ | λ²”μ„ | μ„¤λ… |
|---------|--------|------|------|
| `k1` | 1.2 | 1.0-3.0 | μ©μ–΄ λΉλ„ ν¬ν™”μ  |
| `b` | 0.75 | 0.0-1.0 | λ¬Έμ„ κΈΈμ΄ μ •κ·ν™” κ°•λ„ |

---

## π“ **5. μ„±λ¥ μµμ ν™” νλΌλ―Έν„°**

**νμΌ μ„μΉ**: `app/rag/enhanced_rag.py` (36-39ν–‰)

```python
# λ³‘λ ¬ μ²λ¦¬ κ΄€λ¦¬μλ“¤
self.parallel_search_manager = ParallelSearchManager(max_concurrent=4)
self.batch_processor = AsyncBatchProcessor(batch_size=10, max_concurrent=3)
```

| νλΌλ―Έν„° | κΈ°λ³Έκ°’ | λ²”μ„ | μ„¤λ… |
|---------|--------|------|------|
| `max_concurrent` | 4 | 1-16 | λ™μ‹ μ‹¤ν–‰ κ°€λ¥ν• κ²€μƒ‰ μ |
| `batch_size` | 10 | 5-50 | λ°°μΉ μ²λ¦¬ ν¬κΈ° |

---

## π― **μ‹λ‚λ¦¬μ¤λ³„ μµμ  μ„¤μ •**

### π€ **μ„±λ¥ μ°μ„  μ„¤μ •** (λΉ λ¥Έ μ‘λ‹µ)

```python
# μ²­ν‚Ή μ„¤μ •
chunk_size = 800
chunk_overlap = 200
use_semantic_chunking = False

# κ²€μƒ‰ μ„¤μ •
k = 3
score_threshold = 0.5

# ν•μ΄λΈλ¦¬λ“ κ°€μ¤‘μΉ
vector_weight = 0.6
keyword_weight = 0.4
bm25_weight = 0.0
```

**μμƒ μ„±λ¥**: μ‘λ‹µμ‹κ°„ 1-2μ΄, μ •ν™•λ„ 70-80%

### π― **ν’μ§ μ°μ„  μ„¤μ •** (μ •ν™•ν• λ‹µλ³€)

```python
# μ²­ν‚Ή μ„¤μ •
chunk_size = 1500
chunk_overlap = 500
use_semantic_chunking = True
similarity_threshold = 0.6

# κ²€μƒ‰ μ„¤μ •
k = 7
score_threshold = 0.1

# ν•μ΄λΈλ¦¬λ“ κ°€μ¤‘μΉ
vector_weight = 0.4
keyword_weight = 0.4
bm25_weight = 0.2
```

**μμƒ μ„±λ¥**: μ‘λ‹µμ‹κ°„ 3-5μ΄, μ •ν™•λ„ 90-95%

### β–οΈ **κ· ν• μ„¤μ •** (μ„±λ¥κ³Ό ν’μ§ κ· ν•)

```python
# μ²­ν‚Ή μ„¤μ •
chunk_size = 1200
chunk_overlap = 300
use_semantic_chunking = True

# κ²€μƒ‰ μ„¤μ •
k = 5
score_threshold = 0.2

# ν•μ΄λΈλ¦¬λ“ κ°€μ¤‘μΉ
vector_weight = 0.5
keyword_weight = 0.3
bm25_weight = 0.2
```

**μμƒ μ„±λ¥**: μ‘λ‹µμ‹κ°„ 2-3μ΄, μ •ν™•λ„ 85-90%

---

## π› οΈ **νλΌλ―Έν„° μμ • λ°©λ²•**

### 1. **μ½”λ“ μ§μ ‘ μμ •**
κ° νμΌμ ν•΄λ‹Ή μ„μΉμ—μ„ νλΌλ―Έν„° κ°’μ„ μ§μ ‘ μμ •

### 2. **ν™κ²½ λ³€μ μ‚¬μ©** (κ¶μ¥)
`app/core/config.py`μ— RAG μ„¤μ • μ¶”κ°€ ν›„ ν™κ²½ λ³€μλ΅ μ μ–΄

### 3. **λ°νƒ€μ„ λ™μ  μ„¤μ •**
ν…μ¤νΈμ©μΌλ΅ λ°νƒ€μ„μ— νλΌλ―Έν„° λ³€κ²½

---

## π“ **μ„±λ¥ λ¨λ‹ν„°λ§**

### **λ¨λ‹ν„°λ§ λ„κµ¬**

```bash
# RAG μ‹μ¤ν… μƒνƒ ν™•μΈ
python3 rag_health_check.py

# λ²΅ν„° DB ν†µκ³„ ν™•μΈ
python3 vector_db_manager.py stats

# λ€ν™”ν• ν…μ¤νΈ
python3 tools/interactive_chat.py
```

---

## π”§ **νλ‹ κ°€μ΄λ“λΌμΈ**

### **λ‹¨κ³„λ³„ μµμ ν™” μ ‘κ·Όλ²•**

1. **κΈ°λ³Έ μ„¤μ •μΌλ΅ μ‹μ‘**: κΈ°λ³Έ κ· ν• μ„¤μ • μ‚¬μ©
2. **μ„±λ¥ μ”κµ¬μ‚¬ν•­ ν™•μΈ**: μ‘λ‹µμ‹κ°„ vs μ •ν™•λ„ μ°μ„ μμ„ κ²°μ •
3. **μ μ§„μ  μ΅°μ •**: ν• λ²μ— ν•λ‚μ νλΌλ―Έν„°λ§ λ³€κ²½
4. **ν…μ¤νΈ λ° κ²€μ¦**: κ° λ³€κ²½μ‚¬ν•­μ ν¨κ³Ό μΈ΅μ •
5. **μµμ κ°’ λ„μ¶**: μ—¬λ¬ ν…μ¤νΈλ¥Ό ν†µν• μµμ  μ΅°ν•© μ°ΎκΈ°

### **μ£Όμμ‚¬ν•­**

- **λ©”λ¨λ¦¬ μ‚¬μ©λ‰**: ν° chunk_sizeμ™€ λ†’μ€ k κ°’μ€ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ¦κ°€
- **μΌκ΄€μ„± μ μ§€**: κ΄€λ ¨ νλΌλ―Έν„°λ“¤ κ°„μ κ· ν• κ³ λ ¤
- **λ„λ©”μΈ νΉμ„±**: λ¬Έμ„ μ ν•κ³Ό μ§λ¬Έ ν¨ν„΄μ— λ§λ” μ΅°μ • ν•„μ”
- **μ§€μ†μ  λ¨λ‹ν„°λ§**: μ‹¤μ  μ‚¬μ© ν¨ν„΄μ— λ”°λ¥Έ μ§€μ†μ  μµμ ν™”

---

**π“ λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-07-07  
**π“ λ²„μ „**: 1.0.0  
**π“ μ‘μ„±μ**: MOJI AI Agent Development Team
